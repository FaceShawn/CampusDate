<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AdminElseController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">spring-boot-campus-date</a> &gt; <a href="index.source.html" class="el_package">com.campus.controller</a> &gt; <span class="el_source">AdminElseController.java</span></div><h1>AdminElseController.java</h1><pre class="source lang-java linenums">package com.campus.controller;

import java.security.NoSuchAlgorithmException;
import java.util.Date;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.campus.common.utils.EncryptUtil;
import com.campus.common.utils.ErrorResponseUtil;
import com.campus.common.utils.StringUtil;
import com.campus.model.User;
import com.campus.service.UserService;

@Controller
@RequestMapping(value=&quot;/aec&quot;)
<span class="nc" id="L25">public class AdminElseController {</span>
	 @Autowired
	    private UserService userService;
	 /**
	     * 管理员注册
	     *
	     * @param request
	     */
	    @RequestMapping(value=&quot;/manageregistering&quot; ,method = RequestMethod.POST, produces = &quot;application/json; charset=utf-8&quot;)
	    @ResponseBody
	    public String registering(HttpServletRequest request){
	        // 获取传递过来的参数
<span class="nc" id="L37">	        String email = request.getParameter(&quot;email&quot;);</span>
<span class="nc" id="L38">	        String userName = request.getParameter(&quot;userName&quot;);</span>
<span class="nc" id="L39">	        String dept_code = request.getParameter(&quot;dept_code&quot;);</span>
<span class="nc" id="L40">	        String password = request.getParameter(&quot;password&quot;);</span>
<span class="nc" id="L41">	        String passwordConfirm = request.getParameter(&quot;passwordConfirm&quot;);</span>
	        
	        
	        // 验证参数是否合法
<span class="nc bnc" id="L45" title="All 2 branches missed.">	        if(StringUtil.isEmpty(email)) {</span>
<span class="nc" id="L46">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, &quot;Email can not be null&quot;);</span>
	        }
	       
<span class="nc bnc" id="L49" title="All 2 branches missed.">	        if(StringUtil.isEmpty(password)) {</span>
<span class="nc" id="L50">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, &quot;Password can not be null&quot;);</span>
	        }
<span class="nc bnc" id="L52" title="All 2 branches missed.">	        if(StringUtil.isEmpty(passwordConfirm)) {</span>
<span class="nc" id="L53">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, &quot;Confirm password can not be null&quot;);</span>
	        }
<span class="nc bnc" id="L55" title="All 2 branches missed.">	        if(!password.equals(passwordConfirm)){</span>
<span class="nc" id="L56">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, &quot;Two passwords are not same&quot;);</span>
	        }

	        // 验证用户名是否已经注册过
	        User user ;
	        try {
<span class="nc" id="L62">	            user = userService.findByEmail(email);</span>
<span class="nc" id="L63">	        }catch(Exception e){</span>
<span class="nc" id="L64">	            user = null;</span>
<span class="nc" id="L65">	        }</span>
<span class="nc bnc" id="L66" title="All 2 branches missed.">	        if(user != null){</span>
<span class="nc" id="L67">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, &quot;The email is registered, please turn to login&quot;);</span>
	        }
	        // md5 加密
<span class="nc" id="L70">	        String md5Pwd = EncryptUtil.getMD5(password);</span>
	        // sha-1 加密
	        String shaPwd;
	        try {
<span class="nc" id="L74">	            shaPwd = EncryptUtil.encryptSHA(password) ;</span>
<span class="nc" id="L75">	        } catch (NoSuchAlgorithmException e) {</span>
<span class="nc" id="L76">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, &quot;The password can not be encrypted&quot;);</span>
<span class="nc" id="L77">	        }</span>
	        
	        // 将参数写入新模型
<span class="nc" id="L80">	        Date date = new Date();</span>
<span class="nc" id="L81">	        User newUser = new User();</span>
	        
<span class="nc" id="L83">	        Long timeStamp = System.currentTimeMillis();  //获取当前时间戳</span>
	        
<span class="nc" id="L85">	        newUser.setEmail(email);</span>
<span class="nc" id="L86">	        newUser.setUserName(userName);</span>
<span class="nc" id="L87">	        newUser.setDeptCode(dept_code);</span>
<span class="nc" id="L88">	        newUser.setPassword(shaPwd);</span>
	        
	        // 验证用户类型，设置用户组
<span class="nc" id="L91">	        newUser.setUserGroup(&quot;alu&quot;);</span>
	        
<span class="nc" id="L93">	        newUser.setCreateTime(date);</span>
<span class="nc" id="L94">	        newUser.setUpdateTime(date);</span>
	        
	        // 将新用户写入数据库
	        try {
<span class="nc" id="L98">	            userService.insert(newUser);</span>
<span class="nc" id="L99">	        }catch(Exception e){</span>
<span class="nc" id="L100">	            return ErrorResponseUtil.setResponse(&quot;400&quot;, e.getMessage());</span>
<span class="nc" id="L101">	        }</span>
	        
<span class="nc" id="L103">	        return ErrorResponseUtil.setResponse(&quot;200&quot;, &quot;register success&quot;);</span>
	        
	    }
	    
	    /**
	     * 根据id删除管理员
	     */
	    @RequestMapping(value = &quot;/delete&quot;, method = RequestMethod.GET)
	    //@ResponseBody
	    public void goDelete(HttpServletRequest request ,HttpServletResponse res) {
//	        int userid = Integer.valueOf(request.getParameter(&quot;userid&quot;));
<span class="nc" id="L114">	        String id = request.getParameter(&quot;id&quot;);</span>
<span class="nc" id="L115">	      System.out.println(&quot;1111&quot;+id);</span>
<span class="nc" id="L116">	        userService.delete(id);</span>
	       // return &quot;login/man/Maintence&quot;;
	    	//http://localhost:8080/admin/Maintence
	    		//return &quot;redirect:admin/Maintence&quot;;
	        try{
<span class="nc" id="L121">	    	res.sendRedirect(&quot;http://localhost:8080/admin/Maintence&quot;);}catch(Exception e){</span>
	    		
<span class="nc" id="L123">	    	}</span>
<span class="nc" id="L124">	    }</span>
	    
	    /**
	     * 将管理员密码置为6个零
	     */
	 
	    @RequestMapping(value = &quot;/change&quot;, method = RequestMethod.GET)
	    public void goChange(HttpServletRequest request ,HttpServletResponse res) {
//	        int userid = Integer.valueOf(request.getParameter(&quot;userid&quot;));
<span class="nc" id="L133">	        String id = request.getParameter(&quot;id&quot;);</span>
<span class="nc" id="L134">	        User user=userService.findById(id);</span>
	       
	        // sha-1 加密
<span class="nc" id="L137">	        String shaPwd=null;</span>
	        try {
<span class="nc" id="L139">	            shaPwd = EncryptUtil.encryptSHA(&quot;000000&quot;) ;</span>
<span class="nc" id="L140">	        } catch (NoSuchAlgorithmException e) {</span>
	           
<span class="nc" id="L142">	        }</span>
<span class="nc" id="L143">	        user.setPassword(shaPwd);</span>
<span class="nc" id="L144">	        userService.insert(user);</span>
	       // return &quot;login/man/Maintence&quot;;
	        try{
<span class="nc" id="L147">		    	res.sendRedirect(&quot;http://localhost:8080/admin/Maintence&quot;);}catch(Exception e){</span>
		    		
<span class="nc" id="L149">		    	}</span>
<span class="nc" id="L150">	    }</span>
	    
	  
	    
	    
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>